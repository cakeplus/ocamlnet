<html><head><!--
     Copyright (c) 1998-2000 The OpenSSL Project, http://www.openssl.org/
     Author:   OpenSSL Project (openssl@openssl.org)
     Modified: 2005-03-30 14:01:00.
     Generated from ``SSL_shutdown.wml'' via WML 2.0.9 (18-Oct-2002).
               by OpenSSL Project (openssl@openssl.org)
               on 2005-03-31 15:09:07.

     DO NOT EDIT THIS FILE DIRECTLY! INSTEAD EDIT ``SSL_shutdown.wml''.
-->

<meta name="Copyright" content="1998-2000 The OpenSSL Project, http://www.openssl.org/">
<meta name="Author" content="OpenSSL Project, openssl@openssl.org">
<meta name="Generator" content="WML 2.0.9 (18-Oct-2002)">
<meta name="Modified" content="2005-03-30 14:01:00"><title>OpenSSL: Documents, SSL_shutdown(3)</title>

<style type="text/css"><!--
BODY { position: absolute; left: 0px; top: 0px; background: #666699; }
A { text-decoration: none; font-weight: bold; }
A:link { text-decoration: none; font-weight: bold; color: #666699; }
A:visited { text-decoration: none; font-weight: bold; color: #666699; }
A:hover { text-decoration: none; font-weight: bold; color: #666699; text-decoration: underline; }
#red { color: #cc3333; }
#sf { font-family: arial,helvetica; font-variant: normal; font-style: normal; }
#sfl { font-weight: bold; font-family: arial,helvetica; font-size: 16pt; line-height: 16pt; font-variant: normal; font-style: normal; }
H1 { font-weight: bold; font-size: 18pt; line-height: 18pt; font-family: arial,helvetica; font-variant: normal; font-style: normal; }
H2 { font-weight: bold; font-size: 14pt; line-height: 14pt; font-family: arial,helvetica; font-variant: normal; font-style: normal; }
H3 { font-weight: bold; font-size: 12pt; line-height: 12pt; font-family: arial,helvetica; font-variant: normal; font-style: normal; }
--></style></head>
<body leftmargin="0" rightmargin="0" topmargin="0" alink="#6666cc" bgcolor="#666699" link="#6666cc" marginheight="0" text="#000000" vlink="#6666cc">
<table summary="" border="0" cellpadding="0" cellspacing="0" width="100%">
  <tbody><tr><td align="left" bgcolor="#666699" width="100"><img src="SSL_shutdown_dateien/page-head-tl.jpg" alt="OpenSSL" height="80" width="100"></td><td colspan="2" align="left" bgcolor="#666699" width="600"><img src="SSL_shutdown_dateien/page-head-tm.jpg" alt="" height="80" width="600"></td><td align="right" bgcolor="#666699" width="20">&nbsp;&nbsp;&nbsp;</td><td align="right" bgcolor="#666699" width="50">&nbsp;</td></tr>
  <tr><td align="left" width="100"><img src="SSL_shutdown_dateien/page-head-bl.jpg" alt="" height="20" width="100"></td><td align="left" width="20"><img src="SSL_shutdown_dateien/page-head-bm.jpg" alt="" height="20" width="20"></td><td align="left" bgcolor="#ffffff" width="100%">
<table summary="" border="0" cellpadding="0" cellspacing="0">
        <tbody><tr>
<td><font face="Arial,Helvetica">&nbsp;<a href="http://www.openssl.org/docs/" onmouseover="self.status = '../'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = '../'; return true" onblur="self.status = ''; return true"><font color="#666666">Index</font></a></font>&nbsp;</td><td>|</td>
<td><font face="Arial,Helvetica">&nbsp;<a href="http://www.openssl.org/docs/apps/openssl.html" onmouseover="self.status = '../apps/openssl.html'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = '../apps/openssl.html'; return true" onblur="self.status = ''; return true"><font color="#666666">openssl(1)</font></a></font>&nbsp;</td><td>|</td>
<td><font face="Arial,Helvetica">&nbsp;<a href="http://www.openssl.org/docs/ssl/ssl.html" onmouseover="self.status = '../ssl/ssl.html'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = '../ssl/ssl.html'; return true" onblur="self.status = ''; return true"><font color="#666666">ssl(3)</font></a></font>&nbsp;</td><td>|</td>
<td><font face="Arial,Helvetica">&nbsp;<a href="http://www.openssl.org/docs/crypto/crypto.html" onmouseover="self.status = '../crypto/crypto.html'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = '../crypto/crypto.html'; return true" onblur="self.status = ''; return true"><font color="#666666">crypto(3)</font></a></font>&nbsp;</td><td>|</td>
<td><font face="Arial,Helvetica">&nbsp;<a href="http://www.openssl.org/docs/HOWTO/" onmouseover="self.status = '../HOWTO/'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = '../HOWTO/'; return true" onblur="self.status = ''; return true"><font color="#666666">HOWTO</font></a></font>&nbsp;</td><td>|</td>
<td><font face="Arial,Helvetica">&nbsp;<a href="http://www.openssl.org/docs/misc/" onmouseover="self.status = '../misc/'; return true" onmouseout="self.status = ''; return true" onfocus="self.status = '../misc/'; return true" onblur="self.status = ''; return true"><font color="#666666">misc</font></a></font>&nbsp;</td><td></td>
</tr>
      </tbody></table>
</td><td align="right" width="20"><img src="SSL_shutdown_dateien/page-corner-tr.gif" alt="" height="20" width="20"></td><td align="right" bgcolor="#666699" width="50">&nbsp;</td></tr>
  <tr><td align="left" bgcolor="#666699" valign="top" width="100"><table summary="" border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><img src="SSL_shutdown_dateien/page-navbar-top.jpg" alt="" height="11" width="100"></td></tr>
<script type="text/javascript" language="JavaScript">
<!-- Hiding the code
function nb_imgNormal(imgName) {
    if (document.images) {
        document[imgName].src = eval(imgName + '_n.src');
        self.status = '';
    }
}
function nb_imgSelect(imgName) {
    if (document.images) {
        document[imgName].src = eval(imgName + '_s.src');
        self.status = '';
    }
}
function nb_imgOver(imgName, nohints, descript) {
    if (document.images) {
        document[imgName].src = eval(imgName + '_o.src');
        if (! nohints) self.status = descript;
    }
}
// done hiding -->
</script>
<script type="text/javascript" language="JavaScript">
<!-- Hiding the code
if (document.images) {
    nb_img1_title_n = new Image();
    nb_img1_title_n.src = '../../images/page-navbar-ti-n.jpg';
    nb_img1_title_o = new Image();
    nb_img1_title_o.src = '../../images/page-navbar-ti-s.jpg';
    nb_img1_FAQ_n = new Image();
    nb_img1_FAQ_n.src = '../../images/page-navbar-fq-n.jpg';
    nb_img1_FAQ_o = new Image();
    nb_img1_FAQ_o.src = '../../images/page-navbar-fq-s.jpg';
    nb_img1_about_n = new Image();
    nb_img1_about_n.src = '../../images/page-navbar-ab-n.jpg';
    nb_img1_about_o = new Image();
    nb_img1_about_o.src = '../../images/page-navbar-ab-s.jpg';
    nb_img1_news_n = new Image();
    nb_img1_news_n.src = '../../images/page-navbar-ne-n.jpg';
    nb_img1_news_o = new Image();
    nb_img1_news_o.src = '../../images/page-navbar-ne-s.jpg';
    nb_img1_docs_s = new Image();
    nb_img1_docs_s.src = '../../images/page-navbar-do-s.jpg';
    nb_img1_docs_o = new Image();
    nb_img1_docs_o.src = '../../images/page-navbar-do-s.jpg';
    nb_img1_source_n = new Image();
    nb_img1_source_n.src = '../../images/page-navbar-so-n.jpg';
    nb_img1_source_o = new Image();
    nb_img1_source_o.src = '../../images/page-navbar-so-s.jpg';
    nb_img1_contrib_n = new Image();
    nb_img1_contrib_n.src = '../../images/page-navbar-co-n.jpg';
    nb_img1_contrib_o = new Image();
    nb_img1_contrib_o.src = '../../images/page-navbar-co-s.jpg';
    nb_img1_support_n = new Image();
    nb_img1_support_n.src = '../../images/page-navbar-su-n.jpg';
    nb_img1_support_o = new Image();
    nb_img1_support_o.src = '../../images/page-navbar-su-s.jpg';
    nb_img1_related_n = new Image();
    nb_img1_related_n.src = '../../images/page-navbar-re-n.jpg';
    nb_img1_related_o = new Image();
    nb_img1_related_o.src = '../../images/page-navbar-re-s.jpg';
}
// done hiding -->
</script>
<tr><td><a href="http://www.openssl.org/" onmouseover="nb_imgOver('nb_img1_title', 0, 'Title'); return true" onmouseout="nb_imgNormal('nb_img1_title'); return true" onfocus="nb_imgOver('nb_img1_title', 0, 'Title'); return true" onblur="nb_imgNormal('nb_img1_title'); return true"><img name="nb_img1_title" src="SSL_shutdown_dateien/page-navbar-ti-n.jpg" alt="Title" border="0" height="27" width="100"></a></td></tr>
<tr><td><a href="http://www.openssl.org/support/faq.html" onmouseover="nb_imgOver('nb_img1_FAQ', 0, 'FAQ'); return true" onmouseout="nb_imgNormal('nb_img1_FAQ'); return true" onfocus="nb_imgOver('nb_img1_FAQ', 0, 'FAQ'); return true" onblur="nb_imgNormal('nb_img1_FAQ'); return true"><img name="nb_img1_FAQ" src="SSL_shutdown_dateien/page-navbar-fq-n.jpg" alt="FAQ" border="0" height="27" width="100"></a></td></tr>
<tr><td><a href="http://www.openssl.org/about/" onmouseover="nb_imgOver('nb_img1_about', 0, 'About'); return true" onmouseout="nb_imgNormal('nb_img1_about'); return true" onfocus="nb_imgOver('nb_img1_about', 0, 'About'); return true" onblur="nb_imgNormal('nb_img1_about'); return true"><img name="nb_img1_about" src="SSL_shutdown_dateien/page-navbar-ab-n.jpg" alt="About" border="0" height="27" width="100"></a></td></tr>
<tr><td><a href="http://www.openssl.org/news/" onmouseover="nb_imgOver('nb_img1_news', 0, 'News'); return true" onmouseout="nb_imgNormal('nb_img1_news'); return true" onfocus="nb_imgOver('nb_img1_news', 0, 'News'); return true" onblur="nb_imgNormal('nb_img1_news'); return true"><img name="nb_img1_news" src="SSL_shutdown_dateien/page-navbar-ne-n.jpg" alt="News" border="0" height="27" width="100"></a></td></tr>
<tr><td><a href="http://www.openssl.org/docs/" onmouseover="nb_imgOver('nb_img1_docs', 0, 'Documents'); return true" onmouseout="nb_imgSelect('nb_img1_docs'); return true" onfocus="nb_imgOver('nb_img1_docs', 0, 'Documents'); return true" onblur="nb_imgSelect('nb_img1_docs'); return true"><img name="nb_img1_docs" src="SSL_shutdown_dateien/page-navbar-do-s.jpg" alt="Documents" border="0" height="27" width="100"></a></td></tr>
<tr><td><a href="http://www.openssl.org/source/" onmouseover="nb_imgOver('nb_img1_source', 0, 'Source'); return true" onmouseout="nb_imgNormal('nb_img1_source'); return true" onfocus="nb_imgOver('nb_img1_source', 0, 'Source'); return true" onblur="nb_imgNormal('nb_img1_source'); return true"><img name="nb_img1_source" src="SSL_shutdown_dateien/page-navbar-so-n.jpg" alt="Source" border="0" height="27" width="100"></a></td></tr>
<tr><td><a href="http://www.openssl.org/contrib/" onmouseover="nb_imgOver('nb_img1_contrib', 0, 'Contribution'); return true" onmouseout="nb_imgNormal('nb_img1_contrib'); return true" onfocus="nb_imgOver('nb_img1_contrib', 0, 'Contribution'); return true" onblur="nb_imgNormal('nb_img1_contrib'); return true"><img name="nb_img1_contrib" src="SSL_shutdown_dateien/page-navbar-co-n.jpg" alt="Contribution" border="0" height="27" width="100"></a></td></tr>
<tr><td><a href="http://www.openssl.org/support/" onmouseover="nb_imgOver('nb_img1_support', 0, 'Support'); return true" onmouseout="nb_imgNormal('nb_img1_support'); return true" onfocus="nb_imgOver('nb_img1_support', 0, 'Support'); return true" onblur="nb_imgNormal('nb_img1_support'); return true"><img name="nb_img1_support" src="SSL_shutdown_dateien/page-navbar-su-n.jpg" alt="Support" border="0" height="27" width="100"></a></td></tr>
<tr><td><a href="http://www.openssl.org/related/" onmouseover="nb_imgOver('nb_img1_related', 0, 'Related'); return true" onmouseout="nb_imgNormal('nb_img1_related'); return true" onfocus="nb_imgOver('nb_img1_related', 0, 'Related'); return true" onblur="nb_imgNormal('nb_img1_related'); return true"><img name="nb_img1_related" src="SSL_shutdown_dateien/page-navbar-re-n.jpg" alt="Related" border="0" height="27" width="100"></a></td></tr>
    <tr><td><img src="SSL_shutdown_dateien/page-navbar-bot.jpg" alt="" height="150" width="100"><br><p></p></td></tr>
  </tbody></table>
</td><td align="left" bgcolor="#ffffff" valign="top" width="20">&nbsp;</td><td align="left" bgcolor="#ffffff" valign="top"><br>
        
<h1>SSL_shutdown(3)</h1>
<!-- INDEX BEGIN -->
<ul>
	<li><a href="#NAME">NAME</a>
	</li><li><a href="#SYNOPSIS">SYNOPSIS</a>
	</li><li><a href="#DESCRIPTION">DESCRIPTION</a>
	</li><li><a href="#NOTES">NOTES</a>
	</li><li><a href="#RETURN_VALUES">RETURN VALUES</a>
	</li><li><a href="#SEE_ALSO">SEE ALSO</a>
</li></ul>
<!-- INDEX END -->
<hr>
<p>
</p><hr>
<h1><a name="NAME">NAME</a></h1>
<p>
SSL_shutdown - shut down a TLS/SSL connection
</p>
<p>
</p><hr>
<h1><a name="SYNOPSIS">SYNOPSIS</a></h1>
<pre> #include &lt;openssl/ssl.h&gt;
</pre>
<pre> int SSL_shutdown(SSL *ssl);
</pre>
<p>
</p><hr>
<h1><a name="DESCRIPTION">DESCRIPTION</a></h1>
<p>
<code>SSL_shutdown()</code> shuts down an active TLS/SSL connection. It
sends the ``close notify'' shutdown alert to the peer.
</p>
<p>
</p><hr>
<h1><a name="NOTES">NOTES</a></h1>
<p>
<code>SSL_shutdown()</code> tries to send the ``close notify'' shutdown
alert to the peer. Whether the operation succeeds or not, the
SSL_SENT_SHUTDOWN flag is set and a currently open session is considered
closed and good and will be kept in the session cache for further reuse.
</p>
<p>
The shutdown procedure consists of 2 steps: the sending of the ``close
notify'' shutdown alert and the reception of the peer's ``close notify''
shutdown alert. According to the TLS standard, it is acceptable for an
application to only send its shutdown alert and then close the underlying
connection without waiting for the peer's response (this way resources can
be saved, as the process can already terminate or serve another
connection). When the underlying connection shall be used for more
communications, the complete shutdown procedure (bidirectional ``close
notify'' alerts) must be performed, so that the peers stay synchronized.
</p>
<p>
<code>SSL_shutdown()</code> supports both uni- and bidirectional shutdown
by its 2 step behaviour.
</p>
<dl>
<dt><strong><a name="item_When">When the application is the first party to send the "close notify"
alert, SSL_shutdown() will only send the alert and then set the
SSL_SENT_SHUTDOWN flag (so that the session is considered good and will
be kept in cache). SSL_shutdown() will then return with 0. If a unidirectional
shutdown is enough (the underlying connection shall be closed anyway), this
first call to SSL_shutdown() is sufficient. In order to complete the
bidirectional shutdown handshake, SSL_shutdown() must be called again.
The second call will make SSL_shutdown() wait for the peer's "close notify"
shutdown alert. On success, the second call to SSL_shutdown() will return
with 1.</a></strong></dt><dd>&nbsp;</dd><dt><strong><a name="item_If">If the peer already sent the "close notify" alert <strong>and</strong> it was
already processed implicitly inside another function
(</a><a href="http://www.openssl.org/docs/ssl/SSL_read.html#">SSL_read(3)</a>), the SSL_RECEIVED_SHUTDOWN flag is set.
SSL_shutdown() will send the "close notify" alert, set the SSL_SENT_SHUTDOWN
flag and will immediately return with 1.
Whether SSL_RECEIVED_SHUTDOWN is already set can be checked using the
SSL_get_shutdown() (see also <a href="http://www.openssl.org/docs/ssl/SSL_set_shutdown.html#">SSL_set_shutdown(3)</a> call.</strong></dt><dd>&nbsp;</dd></dl>
<p>
It is therefore recommended, to check the return value of
<code>SSL_shutdown()</code> and call <code>SSL_shutdown()</code> again, if
the bidirectional shutdown is not yet complete (return value of the first
call is 0). As the shutdown is not specially handled in the SSLv2 protocol,
<code>SSL_shutdown()</code> will succeed on the first call.
</p>
<p>
The behaviour of <code>SSL_shutdown()</code> additionally depends on the
underlying BIO.
</p>
<p>
If the underlying BIO is <strong>blocking</strong>, <code>SSL_shutdown()</code> will only return once the handshake step has
been finished or an error occurred.
</p>
<p>
If the underlying BIO is <strong>non-blocking</strong>, <code>SSL_shutdown()</code> will also return when the underlying BIO
could not satisfy the needs of <code>SSL_shutdown()</code> to continue the
handshake. In this case a call to <code>SSL_get_error()</code> with the
return value of <code>SSL_shutdown()</code> will yield <strong>SSL_ERROR_WANT_READ</strong> or
<strong>SSL_ERROR_WANT_WRITE</strong>. The calling process then must repeat the call after taking appropriate
action to satisfy the needs of <code>SSL_shutdown().</code> The action
depends on the underlying BIO. When using a non-blocking socket, nothing is
to be done, but <code>select()</code> can be used to check for the required
condition. When using a buffering BIO, like a BIO pair, data must be
written into or retrieved out of the BIO before being able to continue.
</p>
<p>
<code>SSL_shutdown()</code> can be modified to only set the connection to
``shutdown'' state but not actually send the ``close notify'' alert
messages, see <a href="http://www.openssl.org/docs/ssl/SSL_CTX_set_quiet_shutdown.html#">SSL_CTX_set_quiet_shutdown(3)</a>. When ``quiet shutdown'' is enabled, <code>SSL_shutdown()</code> will
always succeed and return 1.
</p>
<p>
</p><hr>
<h1><a name="RETURN_VALUES">RETURN VALUES</a></h1>
<p>
The following return values can occur:
</p>
<dl>
<dt><strong><a name="item_1">1</a></strong></dt><dd>
<p>
The shutdown was successfully completed. The ``close notify'' alert was
sent and the peer's ``close notify'' alert was received.
</p>
</dd><dt><strong><a name="item_0">0</a></strong></dt><dd>
<p>
The shutdown is not yet finished. Call <code>SSL_shutdown()</code> for a
second time, if a bidirectional shutdown shall be performed. The output of <a href="http://www.openssl.org/docs/ssl/SSL_get_error.html#">SSL_get_error(3)</a> may be misleading, as an erroneous SSL_ERROR_SYSCALL may be flagged even
though no error occurred.
</p>
</dd><dt><strong><a name="item__1">-1</a></strong></dt><dd>
<p>
The shutdown was not successful because a fatal error occurred either at
the protocol level or a connection failure occurred. It can also occur if
action is need to continue the operation for non-blocking BIOs. Call <a href="http://www.openssl.org/docs/ssl/SSL_get_error.html#">SSL_get_error(3)</a> with the return value <strong>ret</strong>
to find out the reason.
</p>
</dd></dl>
<p>
</p><hr>
<h1><a name="SEE_ALSO">SEE ALSO</a></h1>
<p>
<a href="http://www.openssl.org/docs/ssl/SSL_get_error.html#">SSL_get_error(3)</a>, <a href="http://www.openssl.org/docs/ssl/SSL_connect.html#">SSL_connect(3)</a>,
<a href="http://www.openssl.org/docs/ssl/SSL_accept.html#">SSL_accept(3)</a>, <a href="http://www.openssl.org/docs/ssl/SSL_set_shutdown.html#">SSL_set_shutdown(3)</a>,
<a href="http://www.openssl.org/docs/ssl/SSL_CTX_set_quiet_shutdown.html#">SSL_CTX_set_quiet_shutdown(3)</a>,
<a href="http://www.openssl.org/docs/ssl/SSL_clear.html#">SSL_clear(3)</a>, <a href="http://www.openssl.org/docs/ssl/SSL_free.html#">SSL_free(3)</a>,
<a href="http://www.openssl.org/docs/ssl/ssl.html#">ssl(3)</a>, <a href="http://www.openssl.org/docs/crypto/bio.html#">bio(3)</a>
</p>
        </td><td align="right" bgcolor="#ffffff" width="20">&nbsp;&nbsp;&nbsp;</td><td align="right" bgcolor="#666699" width="50">&nbsp;</td></tr>
  <tr><td align="left" bgcolor="#666699" valign="top" width="100">&nbsp;</td><td align="left" width="20"><img src="SSL_shutdown_dateien/page-corner-bl.gif" alt="" height="20" width="20"></td><td align="left" bgcolor="#ffffff" valign="top">&nbsp;</td><td align="right" width="20"><img src="SSL_shutdown_dateien/page-corner-br.gif" alt="" height="20" width="20"></td><td align="right" bgcolor="#666699" width="50">&nbsp;</td></tr>
  <tr><td colspan="5" bgcolor="#666699">&nbsp;</td></tr>
</tbody></table>
</body></html>